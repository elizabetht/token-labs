<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MillionTokenLab – Inference API Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card-bg: radial-gradient(circle at top left, #111827, #020617);
      --accent: #5ee7ff;
      --accent-soft: rgba(94, 231, 255, 0.1);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2933;
      --danger: #f97373;
      --radius-xl: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #111827, #020617);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      padding: 20px 20px 16px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.6);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: rgba(15, 23, 42, 0.85);
      color: var(--accent);
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent);
    }

    h1 {
      margin: 10px 0 6px;
      font-size: 26px;
    }

    .subtitle {
      margin: 0 0 12px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 11px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill strong {
      color: var(--accent);
      font-weight: 600;
    }

    .section-title {
      font-size: 13px;
      margin: 14px 0 6px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    code.inline {
      background: #020617;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 12px;
      border: 1px solid #111827;
    }

    pre {
      margin: 6px 0 10px;
      padding: 8px 10px;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #111827;
      font-size: 12px;
      overflow-x: auto;
    }

    .pricing-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 6px;
    }

    .pricing-table th,
    .pricing-table td {
      padding: 6px 6px;
      text-align: left;
    }

    .pricing-table th {
      font-weight: 500;
      color: var(--text-muted);
      border-bottom: 1px solid #111827;
    }

    .pricing-table tr:nth-child(2) {
      background: rgba(15, 23, 42, 0.65);
    }

    .pricing-tag {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
    }

    .pricing-note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .model-meta {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .model-meta strong {
      color: var(--text-main);
      font-weight: 500;
    }

    /* Chat UI */
    .chat-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 360px;
    }

    .chat-log {
      flex: 1;
      background: radial-gradient(circle at top left, #020617, #020617);
      border-radius: 12px;
      border: 1px solid #111827;
      padding: 10px;
      overflow-y: auto;
      font-size: 13px;
      margin-bottom: 10px;
    }

    .msg {
      margin-bottom: 8px;
      display: flex;
      gap: 8px;
    }

    .msg span.role {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      flex-shrink: 0;
      width: 60px;
    }

    .msg span.role.user {
      color: #a5b4fc;
    }

    .msg span.role.assistant {
      color: #6ee7b7;
    }

    .msg span.role.system {
      color: #fbbf24;
    }

    .msg .content {
      white-space: pre-wrap;
    }

    .chat-input-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .inline-label {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .inline-label code {
      font-size: 11px;
    }

    textarea, input[type="text"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #111827;
      background: #020617;
      color: var(--text-main);
      font-size: 13px;
      padding: 6px 9px;
      outline: none;
    }

    textarea:focus, input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(94, 231, 255, 0.4);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 180px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: linear-gradient(135deg, #22d3ee, #6366f1);
      color: #020617;
      font-weight: 500;
      box-shadow: 0 10px 25px rgba(56, 189, 248, 0.35);
    }

    button:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-muted);
      box-shadow: none;
      border: 1px solid #111827;
    }

    .status {
      font-size: 11px;
      color: var(--text-muted);
    }

    .status.error {
      color: var(--danger);
    }

    .small {
      font-size: 11px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Left: marketing + pricing + API -->
    <div>
      <div class="card">
        <div class="badge">
          <div class="badge-dot"></div>
          MillionTokenLab · Inference API
        </div>
        <h1>Model Console</h1>
        <p class="subtitle">
          OpenAI-compatible chat completions on dedicated GPU instances.
          Pick a model, view its pricing, and call it with your own API key.
        </p>

        <div class="section-title">Model & instance</div>
        <div class="pill-row">
          <div class="pill">
            <strong>Model</strong>
            <select id="model-select" style="background: transparent; border: none; color: inherit; font-size: 11px;">
              <!-- options populated by JS -->
            </select>
          </div>
          <div class="pill" id="pill-context">Context&nbsp;≈&nbsp;8K tokens</div>
          <div class="pill" id="pill-gpu">GPU&nbsp;RTX A4500 · 20GB</div>
          <div class="pill" id="pill-endpoint">Instance&nbsp;Primary</div>
        </div>

        <p class="model-meta" id="model-details">
          <!-- filled by JS -->
        </p>

        <div class="section-title">API endpoint</div>
        <p style="font-size: 13px; margin: 4px 0 6px;">
          OpenAI-compatible <code class="inline">/v1/chat/completions</code>:
        </p>
        <pre><code id="endpoint-code">POST https://xv28w4892bizfd-8000.proxy.runpod.net/v1/chat/completions
Content-Type: application/json</code></pre>

        <p style="font-size: 13px; margin: 4px 0 6px;">Example request:</p>
        <pre><code id="curl-example">curl https://xv28w4892bizfd-8000.proxy.runpod.net/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "meta-llama/Llama-3.1-8B-Instruct",
    "messages": [
      {"role": "user", "content": "Say hello from MillionTokenLab."}
    ]
  }'</code></pre>
      </div>

      <div class="card">
        <div class="section-title">Pricing · per model</div>
        <table class="pricing-table">
          <thead>
            <tr>
              <th>Token type</th>
              <th>Unit</th>
              <th>Price (USD)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Input tokens (prompt)</td>
              <td>per 1M</td>
              <td class="pricing-tag" id="price-input">$0.0000</td>
            </tr>
            <tr>
              <td>Output tokens (completion)</td>
              <td>per 1M</td>
              <td class="pricing-tag" id="price-output">$0.0000</td>
            </tr>
          </tbody>
        </table>
        <p class="pricing-note">
          Prices shown here are per 1M tokens and can be updated from your CI
          benchmarks (e.g., vLLM throughput on RTX A4500 at $0.26/hr).
        </p>
      </div>
    </div>

    <!-- Right: chat UI -->
    <div class="card">
      <div class="chat-wrapper">
        <div class="section-title">Chat with the selected model</div>
        <div class="inline-label" style="margin-bottom: 4px;">
          <span class="small">Model:</span>
          <span class="small"><code id="chat-model-label">llama-8b-instruct</code></span>
        </div>

        <div class="chat-log" id="chat-log"></div>

        <div class="chat-input-row">
          <div class="inline-label">
            <span>Message</span>
            <span class="small">Press Enter to send · Shift+Enter for newline</span>
          </div>
          <textarea id="user-input" placeholder="Ask something..."></textarea>

          <div class="btn-row">
            <button id="send-btn">
              <span>Send</span>
              <span style="font-size: 14px;">➤</span>
            </button>
            <button class="btn-secondary" id="reset-btn" type="button">
              Clear chat
            </button>
            <span id="status" class="status"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================
    // CONFIG: Models & endpoints
    // ============================

    // If you have a single shared vLLM endpoint, set this and omit baseUrl per model:
    const DEFAULT_API_BASE_URL = "https://xv28w4892bizfd-8000.proxy.runpod.net";

    // Models & instances.
    // backendName must match what your vLLM server expects in the `model` field
    // (e.g., `--served-model-name llama-8b-instruct`).
    const MODELS = {
      "llama-8b-instruct": {
        backendName: "llama-8b-instruct",
        fullModelName: "meta-llama/Llama-3.1-8B-Instruct",
        context: "8K tokens",
        gpu: "RTX A4500 · 20GB",
        instanceLabel: "Primary A4500",
        baseUrl: DEFAULT_API_BASE_URL, // or override per model
        // Prices per 1M tokens – replace with your benchmarked numbers
        inputPricePerM: 0.0413,
        outputPricePerM: 2.2175,
        description: "General-purpose 8B chat model tuned for coding & reasoning workloads."
      },
      "mistral-7b-instruct": {
        backendName: "mistral-7b-instruct",
        fullModelName: "mistralai/Mistral-7B-Instruct-v0.3",
        context: "8K tokens",
        gpu: "RTX A4500 · 20GB",
        instanceLabel: "Secondary A4500",
        baseUrl: DEFAULT_API_BASE_URL, // same endpoint, different model
        inputPricePerM: 0.0180,
        outputPricePerM: 0.8000,
        description: "Lightweight, fast 7B model ideal for high-throughput applications."
      },
      "qwen-1.5b-instruct": {
        backendName: "qwen-1.5b-instruct",
        fullModelName: "Qwen/Qwen2.5-1.5B-Instruct",
        context: "4K tokens",
        gpu: "RTX 4000 SFF · 8GB",
        instanceLabel: "Small instance",
        baseUrl: "https://xv28w4892bizfd-8000.proxy.runpod.net", // different pod/instance
        inputPricePerM: 0.0100,
        outputPricePerM: 0.4000,
        description: "Small-footprint model for simple tasks where latency and cost matter most."
      }
    };

    let currentModelKey = "llama-8b-instruct"; // default

    // ============================
    // DOM references
    // ============================

    const endpointCode = document.getElementById("endpoint-code");
    const curlExample = document.getElementById("curl-example");
    const modelSelect = document.getElementById("model-select");
    const pillContext = document.getElementById("pill-context");
    const pillGpu = document.getElementById("pill-gpu");
    const pillEndpoint = document.getElementById("pill-endpoint");
    const modelDetails = document.getElementById("model-details");
    const priceInputEl = document.getElementById("price-input");
    const priceOutputEl = document.getElementById("price-output");
    const chatModelLabel = document.getElementById("chat-model-label");
    const chatLogEl = document.getElementById("chat-log");
    const userInputEl = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const resetBtn = document.getElementById("reset-btn");
    const statusEl = document.getElementById("status");

    const messages = []; // full conversation for the selected model

    // ============================
    // Helpers
    // ============================

    function getCurrentModelConfig() {
      return MODELS[currentModelKey];
    }

    function getApiBaseUrl() {
      const cfg = getCurrentModelConfig();
      return (cfg && cfg.baseUrl) || DEFAULT_API_BASE_URL;
    }

    function getDisplayName(fullModelName) {
      // Extract display name from full model name (e.g., "meta-llama/Llama-3.1-8B-Instruct" -> "Llama-3.1-8B Instruct")
      if (!fullModelName) return "Unknown";
      const name = fullModelName.split("/").pop() || fullModelName;
      return name.replace(/-/g, " ").replace(/\s+/g, " ");
    }

    function setStatus(text, isError = false) {
      statusEl.textContent = text || "";
      statusEl.className = "status" + (isError ? " error" : "");
    }

    function appendMessage(role, content) {
      const msg = document.createElement("div");
      msg.className = "msg";

      const roleSpan = document.createElement("span");
      roleSpan.className = "role " + role;
      roleSpan.textContent =
        role === "user"
          ? "You"
          : role === "assistant"
          ? "Model"
          : "System";

      const contentSpan = document.createElement("span");
      contentSpan.className = "content";
      contentSpan.textContent = content;

      msg.appendChild(roleSpan);
      msg.appendChild(contentSpan);
      chatLogEl.appendChild(msg);
      chatLogEl.scrollTop = chatLogEl.scrollHeight;
    }

    function refreshModelUI() {
      const cfg = getCurrentModelConfig();
      if (!cfg) return;

      const baseUrl = getApiBaseUrl();

      if (pillContext) pillContext.textContent = `Context ≈ ${cfg.context}`;
      if (pillGpu) pillGpu.textContent = `GPU ${cfg.gpu}`;
      if (pillEndpoint) pillEndpoint.textContent = `Instance ${cfg.instanceLabel || "N/A"}`;

      if (modelDetails) {
        modelDetails.innerHTML =
          `<strong>${getDisplayName(cfg.fullModelName)}</strong> · ` +
          `${cfg.description || ""}`;
      }

      if (priceInputEl) {
        priceInputEl.textContent = `$${cfg.inputPricePerM.toFixed(4)}`;
      }
      if (priceOutputEl) {
        priceOutputEl.textContent = `$${cfg.outputPricePerM.toFixed(4)}`;
      }
      if (chatModelLabel) {
        chatModelLabel.textContent = cfg.fullModelName;
      }

      if (endpointCode && baseUrl) {
        endpointCode.textContent = `POST ${baseUrl}/v1/chat/completions
Content-Type: application/json`;
      }

      if (curlExample && baseUrl) {
        curlExample.textContent =
`curl ${baseUrl}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "${cfg.fullModelName}",
    "messages": [
      {"role": "user", "content": "Say hello from MillionTokenLab."}
    ]
  }'`;
      }
    }

    // ============================
    // Model selection init
    // ============================

    if (modelSelect) {
      Object.entries(MODELS).forEach(([key, cfg]) => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = `${getDisplayName(cfg.fullModelName)} (${cfg.backendName})`;
        if (key === currentModelKey) opt.selected = true;
        modelSelect.appendChild(opt);
      });

      modelSelect.addEventListener("change", () => {
        currentModelKey = modelSelect.value;
        messages.length = 0;
        chatLogEl.innerHTML = "";
        setStatus("");
        refreshModelUI();
      });
    }

    // Initial UI sync
    refreshModelUI();

    // ============================
    // Chat send logic
    // ============================

    async function sendMessage() {
      const userText = userInputEl.value.trim();
      const cfg = getCurrentModelConfig();
      const baseUrl = getApiBaseUrl();

      if (!cfg || !baseUrl) {
        setStatus("Model or API base URL not configured.", true);
        return;
      }

      if (!userText) {
        setStatus("Type a message first.", true);
        return;
      }

      setStatus("");
      sendBtn.disabled = true;

      appendMessage("user", userText);
      messages.push({ role: "user", content: userText });
      userInputEl.value = "";

      try {
        const resp = await fetch(baseUrl + "/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: cfg.fullModelName,
            messages: messages,
            max_tokens: 512,
          }),
        });

        if (!resp.ok) {
          const text = await resp.text();
          console.error("Error response:", resp.status, text);
          setStatus("Error: " + resp.status + " – see console", true);
          return;
        }

        const data = await resp.json();
        const choice = data.choices && data.choices[0];
        const reply = choice && choice.message && choice.message.content;

        if (!reply) {
          setStatus("No response from model.", true);
          return;
        }

        messages.push({ role: "assistant", content: reply });
        appendMessage("assistant", reply);
        setStatus("");
      } catch (err) {
        console.error("Network error:", err);
        setStatus("Network error – see console", true);
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    resetBtn.addEventListener("click", () => {
      messages.length = 0;
      chatLogEl.innerHTML = "";
      setStatus("");
    });
  </script>
</body>
</html>
