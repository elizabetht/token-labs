<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TokenLabs â€“ Inference API Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --accent-soft: rgba(99, 102, 241, 0.1);
      --text-main: #1e293b;
      --text-muted: #64748b;
      --border-subtle: #e2e8f0;
      --danger: #ef4444;
      --success: #10b981;
      --radius-xl: 16px;
      --code-bg: #1e293b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.04);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 12px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 6px var(--success);
    }

    h1 {
      margin: 14px 0 8px;
      font-size: 28px;
      font-weight: 700;
      color: var(--text-main);
    }

    .subtitle {
      margin: 0 0 16px;
      font-size: 15px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
    }

    .pill {
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: var(--bg);
      font-size: 12px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill strong {
      color: var(--accent);
      font-weight: 600;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      margin: 18px 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    code.inline {
      background: var(--accent-soft);
      color: var(--accent);
      border-radius: 6px;
      padding: 3px 8px;
      font-size: 12px;
      font-weight: 500;
    }

    pre {
      margin: 8px 0 12px;
      padding: 14px 16px;
      background: var(--code-bg);
      color: #e2e8f0;
      border-radius: 10px;
      font-size: 13px;
      overflow-x: auto;
      line-height: 1.5;
    }

    pre code {
      color: #e2e8f0;
    }

    .pricing-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 8px;
    }

    .pricing-table th,
    .pricing-table td {
      padding: 10px 8px;
      text-align: left;
    }

    .pricing-table th {
      font-weight: 500;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border-subtle);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pricing-table tbody tr {
      border-bottom: 1px solid var(--border-subtle);
    }

    .pricing-table tbody tr:last-child {
      border-bottom: none;
    }

    .pricing-tag {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
    }

    .pricing-note {
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .model-meta {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 8px;
      line-height: 1.5;
    }

    .model-meta strong {
      color: var(--text-main);
      font-weight: 600;
    }

    /* Chat UI */
    .chat-wrapper {
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 360px;
    }

    .chat-log {
      flex: 1;
      background: var(--bg);
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      padding: 12px;
      overflow-y: auto;
      font-size: 13px;
      margin-bottom: 12px;
    }

    .msg {
      margin-bottom: 10px;
      display: flex;
      gap: 10px;
    }

    .msg span.role {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
      flex-shrink: 0;
      width: 60px;
    }

    .msg span.role.user {
      color: var(--accent);
    }

    .msg span.role.assistant {
      color: var(--success);
    }

    .msg span.role.system {
      color: #f59e0b;
    }

    .msg .content {
      white-space: pre-wrap;
      color: var(--text-main);
      line-height: 1.5;
    }

    .chat-input-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .inline-label {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .inline-label code {
      font-size: 11px;
      background: var(--bg);
      padding: 2px 6px;
      border-radius: 4px;
    }

    textarea, input[type="text"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: var(--bg);
      color: var(--text-main);
      font-size: 14px;
      padding: 10px 12px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    textarea:focus, input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 180px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: var(--accent);
      color: #ffffff;
      font-weight: 600;
      transition: background 0.15s, transform 0.1s;
    }

    button:hover {
      background: var(--accent-light);
    }

    button:active {
      transform: scale(0.98);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border-subtle);
    }

    .btn-secondary:hover {
      background: var(--bg);
      color: var(--text-main);
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
    }

    .status.error {
      color: var(--danger);
    }

    .small {
      font-size: 12px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Left: marketing + pricing + API -->
    <div>
      <div class="card">
        <div class="badge">
          <div class="badge-dot"></div>
          TokenLabs Â· Inference API
        </div>
        <h1>Model Console</h1>
        <p class="subtitle">
          OpenAI-compatible chat completions on dedicated GPU instances.
          Pick a model, view its pricing, and call it with your own API key.
        </p>

        <div class="section-title">Model & instance</div>
        <div class="pill-row">
          <div class="pill">
            <strong>Model</strong>
            <select id="model-select" style="background: transparent; border: none; color: inherit; font-size: 11px;">
              <!-- options populated by JS -->
            </select>
          </div>
          <div class="pill" id="pill-context">Context&nbsp;â‰ˆ&nbsp;8K tokens</div>
          <div class="pill" id="pill-gpu">GPU&nbsp;RTX A4500 Â· 20GB</div>
          <div class="pill" id="pill-endpoint">Instance&nbsp;Primary</div>
        </div>

        <p class="model-meta" id="model-details">
          <!-- filled by JS -->
        </p>

        <div class="section-title">API endpoint</div>
        <p style="font-size: 13px; margin: 4px 0 6px;">
          OpenAI-compatible <code class="inline">/v1/chat/completions</code>:
        </p>
        <pre><code id="curl-example">curl https://api.tokenlabs.run/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "meta-llama/Llama-3.1-8B-Instruct",
    "messages": [
      {"role": "user", "content": "Say hello from TokenLabs."}
    ]
  }'</code></pre>
      </div>

      <div class="card">
        <div class="section-title">Pricing Â· per model</div>
        <table class="pricing-table">
          <thead>
            <tr>
              <th>Token type</th>
              <th>Unit</th>
              <th>Price (USD)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Input tokens (prompt)</td>
              <td>per 1M</td>
              <td class="pricing-tag" id="price-input">$0.0000</td>
            </tr>
            <tr>
              <td>Cached input tokens</td>
              <td>per 1M</td>
              <td class="pricing-tag" id="price-cached-input">$0.0000</td>
            </tr>
            <tr>
              <td>Output tokens (completion)</td>
              <td>per 1M</td>
              <td class="pricing-tag" id="price-output">$0.0000</td>
            </tr>
          </tbody>
        </table>
        <p class="pricing-note">
          Prices shown here are per 1M tokens and are updated from CI
          benchmarks (e.g., vLLM throughput on RTX A4500 at $0.26/hr).
        </p>
        <p class="pricing-note" style="margin-top: 8px;">
          <a href="benchmark-results.html" style="color: var(--accent); text-decoration: none; font-weight: 500;">
            ðŸ“Š View detailed performance benchmarks â†’
          </a>
        </p>
      </div>
    </div>

    <!-- Right: chat UI -->
    <div class="card">
      <div class="chat-wrapper">
        <div class="section-title">Chat with the selected model</div>
        <div class="inline-label" style="margin-bottom: 4px;">
          <span class="small">Model:</span>
          <span class="small"><code id="chat-model-label">llama-8b-instruct</code></span>
        </div>

        <div class="chat-log" id="chat-log"></div>

        <div class="chat-input-row">
          <div class="inline-label">
            <span>Message</span>
            <span class="small">Press Enter to send Â· Shift+Enter for newline</span>
          </div>
          <textarea id="user-input" placeholder="Ask something..."></textarea>

          <div class="btn-row">
            <button id="send-btn">
              <span>Send</span>
              <span style="font-size: 14px;">âž¤</span>
            </button>
            <button class="btn-secondary" id="reset-btn" type="button">
              Clear chat
            </button>
            <span id="status" class="status"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================
    // CONFIG: Models & endpoints
    // ============================

    // If you have a single shared vLLM endpoint, set this and omit baseUrl per model:
    const DEFAULT_API_BASE_URL = "https://api.tokenlabs.run";

    // Models & instances.
    // backendName must match what your vLLM server expects in the `model` field
    // (e.g., `--served-model-name llama-8b-instruct`).
    const MODELS = {
      "llama-8b-instruct": {
        fullModelName: "meta-llama/Llama-3.1-8B-Instruct",
        context: "128K tokens",
        gpu: "DGX Spark Â· 40GB",
        instanceLabel: "Primary",
        baseUrl: DEFAULT_API_BASE_URL,
        // Prices per 1M tokens â€“ updated by CI benchmarks
        inputPricePerM: 0.06,
        cachedInputPricePerM: 0.0114,
        outputPricePerM: 0.15,
        description: "General-purpose 8B chat model tuned for coding & reasoning workloads."
      }
    };

    let currentModelKey = "llama-8b-instruct"; // default

    // ============================
    // DOM references
    // ============================

    const curlExample = document.getElementById("curl-example");
    const modelSelect = document.getElementById("model-select");
    const pillContext = document.getElementById("pill-context");
    const pillGpu = document.getElementById("pill-gpu");
    const pillEndpoint = document.getElementById("pill-endpoint");
    const modelDetails = document.getElementById("model-details");
    const priceInputEl = document.getElementById("price-input");
    const priceCachedInputEl = document.getElementById("price-cached-input");
    const priceOutputEl = document.getElementById("price-output");
    const chatModelLabel = document.getElementById("chat-model-label");
    const chatLogEl = document.getElementById("chat-log");
    const userInputEl = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const resetBtn = document.getElementById("reset-btn");
    const statusEl = document.getElementById("status");

    const messages = []; // full conversation for the selected model

    // ============================
    // Helpers
    // ============================

    function getCurrentModelConfig() {
      return MODELS[currentModelKey];
    }

    function getApiBaseUrl() {
      const cfg = getCurrentModelConfig();
      return (cfg && cfg.baseUrl) || DEFAULT_API_BASE_URL;
    }

    function getDisplayName(fullModelName) {
      // Extract display name from full model name (e.g., "meta-llama/Llama-3.1-8B-Instruct" -> "Llama-3.1-8B Instruct")
      if (!fullModelName) return "Unknown";
      const name = fullModelName.split("/").pop() || fullModelName;
      return name.replace(/-/g, " ").replace(/\s+/g, " ");
    }

    function setStatus(text, isError = false) {
      statusEl.textContent = text || "";
      statusEl.className = "status" + (isError ? " error" : "");
    }

    function appendMessage(role, content) {
      const msg = document.createElement("div");
      msg.className = "msg";

      const roleSpan = document.createElement("span");
      roleSpan.className = "role " + role;
      roleSpan.textContent =
        role === "user"
          ? "You"
          : role === "assistant"
          ? "Model"
          : "System";

      const contentSpan = document.createElement("span");
      contentSpan.className = "content";
      contentSpan.textContent = content;

      msg.appendChild(roleSpan);
      msg.appendChild(contentSpan);
      chatLogEl.appendChild(msg);
      chatLogEl.scrollTop = chatLogEl.scrollHeight;
    }

    function refreshModelUI() {
      const cfg = getCurrentModelConfig();
      if (!cfg) return;

      const baseUrl = getApiBaseUrl();

      if (pillContext) pillContext.textContent = `Context â‰ˆ ${cfg.context}`;
      if (pillGpu) pillGpu.textContent = `GPU ${cfg.gpu}`;
      if (pillEndpoint) pillEndpoint.textContent = `Instance ${cfg.instanceLabel || "N/A"}`;

      if (modelDetails) {
        modelDetails.innerHTML =
          `<strong>${getDisplayName(cfg.fullModelName)}</strong> Â· ` +
          `${cfg.description || ""}`;
      }

      if (priceInputEl) {
        priceInputEl.textContent = `$${cfg.inputPricePerM.toFixed(2)}`;
      }
      if (priceCachedInputEl) {
        priceCachedInputEl.textContent = `$${cfg.cachedInputPricePerM.toFixed(4)}`;
      }
      if (priceOutputEl) {
        priceOutputEl.textContent = `$${cfg.outputPricePerM.toFixed(2)}`;
      }
      if (chatModelLabel) {
        chatModelLabel.textContent = cfg.fullModelName;
      }

      if (curlExample && baseUrl) {
        curlExample.textContent =
`curl ${baseUrl}/v1/chat/completions \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "${cfg.fullModelName}",
    "messages": [
      {"role": "user", "content": "Say hello from TokenLabs."}
    ]
  }'`;
      }
    }

    // ============================
    // Model selection init
    // ============================

    if (modelSelect) {
      Object.entries(MODELS).forEach(([key, cfg]) => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = getDisplayName(cfg.fullModelName);
        if (key === currentModelKey) opt.selected = true;
        modelSelect.appendChild(opt);
      });

      modelSelect.addEventListener("change", () => {
        currentModelKey = modelSelect.value;
        messages.length = 0;
        chatLogEl.innerHTML = "";
        setStatus("");
        refreshModelUI();
      });
    }

    // Initial UI sync
    refreshModelUI();

    // ============================
    // Chat send logic
    // ============================

    async function sendMessage() {
      const userText = userInputEl.value.trim();
      const cfg = getCurrentModelConfig();
      const baseUrl = getApiBaseUrl();

      if (!cfg || !baseUrl) {
        setStatus("Model or API base URL not configured.", true);
        return;
      }

      if (!userText) {
        setStatus("Type a message first.", true);
        return;
      }

      setStatus("");
      sendBtn.disabled = true;

      appendMessage("user", userText);
      messages.push({ role: "user", content: userText });
      userInputEl.value = "";

      try {
        const resp = await fetch(baseUrl + "/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: cfg.fullModelName,
            messages: messages,
            max_tokens: 512,
          }),
        });

        if (!resp.ok) {
          const text = await resp.text();
          console.error("Error response:", resp.status, text);
          setStatus("Error: " + resp.status + " â€“ see console", true);
          return;
        }

        const data = await resp.json();
        const choice = data.choices && data.choices[0];
        const reply = choice && choice.message && choice.message.content;

        if (!reply) {
          setStatus("No response from model.", true);
          return;
        }

        messages.push({ role: "assistant", content: reply });
        appendMessage("assistant", reply);
        setStatus("");
      } catch (err) {
        console.error("Network error:", err);
        setStatus("Network error â€“ see console", true);
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    resetBtn.addEventListener("click", () => {
      messages.length = 0;
      chatLogEl.innerHTML = "";
      setStatus("");
    });
  </script>
</body>
</html>
